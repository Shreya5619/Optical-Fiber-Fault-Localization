<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OTDR Fiber Fault Detection & Localization</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1 class="main-header">üîç OTDR-Based Fiber Fault Detection & Localization</h1>
    <div class="container">
        <div class="input-section">
            <h2>üì§ OTDR Data Input</h2>
            <form action="/" method="post" enctype="multipart/form-data">
                <button type="submit">Run Analysis</button>
            </form>
        </div>

        {% if data %}
            <div class="results-section">
                <h2>üîÑ ML Processing Pipeline</h2>
                <div class="step-container">
                    <h3>Step 1: Binary Fault Detection</h3>
                    {% if data.binary_prediction.prediction %}
                        <div class="error-box">üö® <strong>FAULT DETECTED</strong><br>Confidence: {{ "%.3f"|format(data.binary_prediction.confidence) }}</div>
                    {% else %}
                        <div class="success-box">‚úÖ <strong>NO FAULT DETECTED</strong><br>Confidence: {{ "%.3f"|format(data.binary_prediction.confidence) }}</div>
                    {% endif %}
                </div>
                
                {% if data.detailed_predictions %}
                    <div class="step-container">
                        <h3>Step 2: Detailed Analysis</h3>
                        <div class="metrics">
                            </div>
                        <div id="otdr-plot"></div>
                        <script>
                            // Generate Plotly chart using JavaScript and data from Flask
                            var trace = {
                                x: [...Array(30).keys()].map(i => i + 1),
                                y: {{ data.otdr_trace | tojson }},
                                mode: 'lines+markers',
                                name: 'OTDR Trace'
                            };
                            var layout = {
                                title: 'OTDR Trace with Fault Localization',
                                xaxis: {title: 'Position Index'},
                                yaxis: {title: 'Normalized Power'}
                            };
                            Plotly.newPlot('otdr-plot', [trace], layout);
                        </script>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</body>
</html>